
- name: Write global bird settings (static)
  copy:
    src: "{{ item }}"
    dest: "/etc/bird/"
    group: "bird"
    mode: '0644'
  with_fileglob:
    - "{{ role_path }}/config/*.conf"
  notify:
    - reconfigure bird

- name: Write global bird settings (dynamic)
  template:
    src: "{{ item }}"
    dest: "/etc/bird/{{ item | basename | regex_replace('\\.j2$', '')}}"
    group: "bird"
    mode: '0644'
  with_fileglob:
    - "{{ role_path }}/config/*.conf.j2"
  notify:
    - reconfigure bird

- name: Make sure /etc/bird/peers exists
  file:
    path: "/etc/bird/peers"
    group: "bird"
    state: directory
    mode: '0755'

- name: Make sure bird logs dir exists
  file:
    path: "/var/log/bird"
    owner: "bird"
    group: "bird"
    state: directory
    mode: '0750'

- name: Write peer settings (static)
  copy:
    src: "{{ item }}"
    dest: "/etc/bird/peers/"
    group: "bird"
    mode: '0644'
  with_fileglob:
    - "{{ role_path }}/config/peers/{{ inventory_hostname }}/*.conf"
  notify:
    - reconfigure bird

- name: Write peer settings (dynamic)
  template:
    src: "{{ item }}"
    dest: "/etc/bird/peers/{{ item | basename | regex_replace('\\.j2$', '')}}"
    group: "bird"
    mode: '0644'
  with_fileglob:
    - "{{ role_path }}/config/peers/{{ inventory_hostname }}/*.conf.j2"
  notify:
    - reconfigure bird
