# Generated by Ansible
{% macro ibgp_cost(nodedata) -%}
{# Costs are specified in ibgp_costs.yml and default to 200 if not given.
   Only one of (A,B) and (B,A) have to be defined, to save space. #}
{% set default_cost = 200 %}
{{ (ibgp_costs.get('%s,%s' % (shortname, nodedata['shortname'])) or
    ibgp_costs.get('%s,%s' % (nodedata['shortname'], shortname)) or default_cost) }}
{%- endmacro %}

{% for host in ansible_play_hosts_all %}
{% if host != inventory_hostname %}
{% set nodedata = hostvars[host] %}

protocol bgp ibgp_{{ nodedata['shortname'] | replace("-", "_") }} {
    local as {{ ownas }};
    neighbor {{ nodedata['ownip6'] }} as {{ ownas }};

    ipv4 {
        cost {{ ibgp_cost(nodedata) }};
        import where source = RTS_BGP && is_valid_network() && !is_self_net();
        export where source = RTS_BGP && is_valid_network() && !is_self_net();
        source address {{ ownip }};
    };

    ipv6 {
        cost {{ ibgp_cost(nodedata) }};
        import where source = RTS_BGP && is_valid_network_v6() && !is_self_net_v6();
        export where source = RTS_BGP && is_valid_network_v6() && !is_self_net_v6();
        source address {{ ownip6 }};
    };
}
{% endif %}
{% endfor %}
