{% macro internal_cost(nodedata) -%}
{% set indirect_penalty = 10 %}
{# Costs are specified in internal_costs.yml.
   Only one of (A,B) and (B,A) have to be defined, to save space. #}
{{ (internal_costs.get('%s,%s' % (shortname, nodedata['shortname'])) or
    internal_costs.get('%s,%s' % (nodedata['shortname'], shortname)) or default_cost) + indirect_penalty }}
{%- endmacro %}

area 0 {
    # Generated by Ansible
{% for host in igp_neighbours[inventory_hostname] %}
{% set nodedata = hostvars[host] %}
    interface "igp-{{ nodedata['shortname'] }}" {
        cost {{ internal_cost(nodedata) }};
        type ptp;
    };
{% endfor %}

    # Loopback interface on each machine
    interface "{{ dummy_ifname_glob }}" {
        stub;
    };
};
