function ca_yvrlab_import() {
    if (bgp_path.len = 0) then {
        ibgp_import_filter();
        accept;
    }
    reject;
}

function ca_yvrlab_export() {
    bgp_med = 200;
    if (NODEID = 114) then {
        bgp_med = 110;
    } else if (NODEID = 34) then {
        bgp_med = 125;
    } else if (NODEID = 113) then {
        bgp_med = 125;
    } else if (NODEID = 123) then {
        bgp_med = 130;
    }
    # prefer direct routes to each node's IPs
    if (source ~ [RTS_DEVICE, RTS_STATIC]) then {
        bgp_med = bgp_med - 50;
    }
    accept;
}

protocol bgp ibgp_ca_yvrlab {
    local as OWNAS;
    neighbor fd86:bad:11b7:aaaa::1 as OWNAS;
    rr client;
    passive on;
    direct;
    interface "igp-ca-yvrgw";

    ipv4 {
        import where ca_yvrlab_import();
        export where ca_yvrlab_export();
        next hop self;
    };

    ipv6 {
        import where ca_yvrlab_import();
        export where ca_yvrlab_export();
        next hop self;
    };
}
