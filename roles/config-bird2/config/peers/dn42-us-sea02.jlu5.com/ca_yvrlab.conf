function ca_yvrlab_import() {
    if (bgp_path.len = 0) then {
        ibgp_import_filter();
        accept;
    }
    reject;
}

function ca_yvrlab_export() {
    bgp_med = 100;
    if (NODEID = 123) then {
        if (bgp_large_community ~ [(OWNAS, LC_ORIGIN_REGION_TAG, 3)]) then {
            bgp_med = 10;
        } else {
            bgp_med = 110;
        }
    } else if (NODEID = 114 && bgp_large_community ~ [(OWNAS, LC_ORIGIN_REGION_TAG, 1..2), (OWNAS, LC_ORIGIN_REGION_TAG, 4)]) then {
        bgp_med = 9;
    }
    accept;
}

protocol bgp ibgp_ca_yvrlab {
    local as OWNAS;
    neighbor 172.22.108.1 as OWNAS;
    rr client;
    passive on;
    direct;

    ipv4 {
        import where ca_yvrlab_import();
        export where ca_yvrlab_export();
        next hop self;
    };
}

protocol bgp ibgp_ca_yvrlab_v6 {
    local as OWNAS;
    neighbor fd86:bad:11b7:aaaa::1 as OWNAS;
    rr client;
    passive on;
    direct;

    ipv6 {
        import where ca_yvrlab_import();
        export where ca_yvrlab_export();
        next hop self;
    };
}
