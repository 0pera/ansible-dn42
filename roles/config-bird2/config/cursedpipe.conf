# just for fun, DON'T actually use this for your main route tables,
# especially if you transit traffic for others

filter cursedpolicy
int neigh;
{
    # look away!
    preference = 1;
    if source = RTS_BGP then {
        # ignore networks that prepend a whole bunch
        neigh = bgp_path.first;
        if bgp_path ~ [= neigh neigh * =] then {
            preference = 2;
        } else {
            preference = bgp_path.len;
        }
    }
    if net.type = NET_IP4 then {
        krt_prefsrc = OWNIP;
        accept;
    } else if net.type = NET_IP6 then {
        krt_prefsrc = OWNIPv6;
        accept;
    } else {
        reject;
    }
}

define CURSED_NET_KERN_TABLE = 100;

ipv4 table cursed;
protocol kernel kernel_cursed {
    ipv4 {
        table cursed;
        export all;
    };
    kernel table 100;
}
protocol pipe wickedswitch {
    table master4;
    peer table cursed;
    export filter cursedpolicy;
    import none;
}

ipv6 table cursed6;
protocol kernel kernel_cursed6 {
    ipv6 {
        table cursed6;
        export all;
    };
    kernel table CURSED_NET_KERN_TABLE;
}
protocol pipe wickedswitch6 {
    table master6;
    peer table cursed6;
    export filter cursedpolicy;
    import none;
}
