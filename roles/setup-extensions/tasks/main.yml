- name: Create scripts dir for dn42
  file:
    path: "{{ automation_root_dir }}"
    state: directory
    mode: '0755'

- name: Create automation account for dn42 scripts
  user:
    name: "{{ automation_user }}"
    group: nogroup
    groups: bird
    system: true
    password: "!"
    home: "{{ automation_user_home }}"

### dn42 peerfinder
- name: Install dn42 peerfinder
  block:
  - name: "Upload peerfinder script"
    copy:
      src: "peerfinder.sh"
      dest: "{{ automation_root_dir }}/peerfinder.sh"
      mode: '0755'

  - name: Create cron job for peerfinder
    cron:
      name: dn42 peerfinder
      minute: "*/5"
      user: "{{ automation_user }}"
      job: "env UUID={{ peerfinder_uuid }} LOGFILE={{ automation_user_home }}/peerfinder.log {{ automation_root_dir }}/peerfinder.sh"
      disabled: "{{ not (open_to_peers | default(true)) }}"
  when: peerfinder_uuid is defined

### igpping
- name: Install igpping
  include_tasks: "igpping.yml"

### bird-lg
- name: Install bird looking glass
  include_tasks: "bird-lg.yml"
