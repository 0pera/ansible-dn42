- name: Create BIRD autoservice config snippets folder
  file:
    path: "/etc/bird/autoservice-available/"
    state: directory

- name: Create BIRD autoservice config snippets folder
  file:
    path: "/etc/bird/autoservice-enabled/"
    state: directory

- name: Configure BIRD autoservice config snippets
  template:
    src: "autoservice-route.conf.j2"
    dest: "/etc/bird/autoservice-available/{{ dummy_iface_entry.key }}.conf"
    group: "bird"
    mode: '0644'
  notify:
    - Reconfigure bird
  loop: "{{ dummy_interfaces | dict2items }}"
  loop_control:
    loop_var: dummy_iface_entry
  when: 'not dummy_iface_entry.value.igp_announce and "anycast_pool" in group_names'
